<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ SuggestView –∏ –≥–µ–æ–∫–æ–¥–µ—Ä (–±–µ–∑ –∫–∞—Ä—Ç—ã) -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=05bead68-7d43-45f3-92ac-a086140b1f39&suggest_apikey=c26df761-b526-4c54-a189-34d436e07268&lang=ru_RU&load=SuggestView,geocode" type="text/javascript"></script>
    <style>
        body { margin: 0; padding: 20px; font-family: sans-serif; background: #f5f5f5; }
        .container { max-width: 500px; margin: 0 auto; }
        #address { width: 100%; padding: 15px; font-size: 18px; border: 1px solid #ccc; border-radius: 10px; box-sizing: border-box; }
        #status { margin-top: 20px; text-align: center; color: #666; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h3>üìç –í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</h3>
        <input type="text" id="address" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì—É–ª—å—Å–∞—Ä–∞, –ì–æ–ª–ª–∏–≤—É–¥..." autocomplete="off" autofocus>
        <div id="loader" class="loader"></div>
        <div id="status"></div>
    </div>

    <script>
        let isProcessing = false;

        ymaps.ready(function() {
            var suggestView = new ymaps.controls.SuggestView('address');
            suggestView.events.add('select', function (e) {
                if (isProcessing) return;
                isProcessing = true;
                var item = e.get('item');
                var selectedAddress = item.displayName;
                document.getElementById('loader').style.display = 'block';
                document.getElementById('status').innerText = 'üîç –ò—â–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã...';

                ymaps.geocode(selectedAddress).then(function (res) {
                    var first = res.geoObjects.get(0);
                    if (first) {
                        var coords = first.geometry.getCoordinates();
                        var fullAddress = first.getAddressLine() || selectedAddress;
                        var result = { lat: coords[0], lon: coords[1], address: fullAddress };
                        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                        document.getElementById('status').innerText = '‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞...';
                        if (window.Telegram && Telegram.WebApp) {
                            Telegram.WebApp.sendData(JSON.stringify(result));
                            setTimeout(() => Telegram.WebApp.close(), 300);
                        } else {
                            alert('–ê–¥—Ä–µ—Å –≤—ã–±—Ä–∞–Ω:\n' + JSON.stringify(result));
                            document.getElementById('loader').style.display = 'none';
                            isProcessing = false;
                        }
                    } else {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã');
                    }
                }).catch(function (err) {
                    console.error(err);
                    document.getElementById('status').innerText = '‚ùå –û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∞–¥—Ä–µ—Å.';
                    document.getElementById('loader').style.display = 'none';
                    isProcessing = false;
                });
            });
        });
    </script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</body>
</html> –≠–¥
